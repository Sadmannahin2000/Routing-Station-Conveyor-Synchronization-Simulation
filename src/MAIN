import java.io.File;
import java.io.FileNotFoundException;
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.locks.ReentrantLock;

/*
 Name:   Sadman Nahin
 Course: CNT 4714 Summer 2025
 Assignment title: Project 2 – Multi-threaded programming in Java
 Date:   June 15, 2025
 Class:  CNT 4714
*/
public class Main {
    public static void main(String[] args) {
        if (args.length == 0) {
            System.out.println("Error: No config file provided.");
            return;
        }

        Scanner scanner;
        try {
            scanner = new Scanner(new File(args[0]));
        } catch (FileNotFoundException e) {
            System.out.println("Error: config file not found.");
            return;
        }

        int stationCount = Integer.parseInt(scanner.nextLine().trim());
        ReentrantLock[] conveyors = new ReentrantLock[stationCount];
        for (int i = 0; i < stationCount; i++) {
            conveyors[i] = new ReentrantLock();
        }

        // Read workloads and print the workload‐set line (#3)
        List<Station> stations = new ArrayList<>();
        for (int id = 1; id <= stationCount; id++) {
            if (!scanner.hasNextLine()) break;
            String line = scanner.nextLine().trim();
            if (line.isEmpty()) { id--; continue; }
            int workload = Integer.parseInt(line);
            System.out.printf(
                    "Routing Station S%d Has Total Workload of %d Package Groups.%n",
                    id, workload
            );

            int inId  = (id - 1 + stationCount) % stationCount;
            int outId = id % stationCount;
            stations.add(new Station(
                    id, workload,
                    conveyors[inId],  inId,
                    conveyors[outId], outId,
                    stationCount
            ));
        }
        scanner.close();

        ExecutorService exec = Executors.newFixedThreadPool(stations.size());
        stations.forEach(exec::submit);
        exec.shutdown();
    }
}
